<?php
/* Main page with two forms: sign up and log in */
include('session.php');
?>
<html>
<head>
    <title>細節</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <script src="Chart.js/dist/Chart.bundle.js"></script>
    <script src="Chart.js/samples/utils.js"></script>
    <style>
    canvas {
        -moz-user-select: none;
        -webkit-user-select: none;
        -ms-user-select: none;
    }
    </style>
</head>
<body>
<style type="text/css">
@import url('https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css');
@import url('https://fonts.googleapis.com/css?family=Lato:100,300,400,700,900');
@import url('https://cdn.datatables.net/1.10.15/css/jquery.dataTables.min.css');
#container{
    border:1px;
    width:100%;
    height: 100%;
    margin:0 auto;
}
#headbox{
    width:97.5%;
    height:25%;
    border:0px;
    margin:0 auto;
    margin-left:1.3%;
    margin-bottom:1%;
    background-color: #B0E0E6;
    overflow:scroll;
}
#sidebar{
    width:20%;
    height:60%;
    border:1px;
    margin-left:1.3%;
    margin-top:0.2%;
    margin-bottom:1%;
    float:left;
    background-color: #B0E0E6;
    overflow:scroll;
}
#sidebody_1{
    width:67%;
    height:60%;
    border:1px;
    margin-left:2%;
    margin-top:0.2%;
    margin-bottom:1%;
    float:left;
    overflow:scroll;
}
#sidebody_2{
    width:8.5%;
    height:60%;
    border:1px;
    margin-top:0.2%;
    margin-bottom:1%;
    float:left;
    overflow:hidden;
}
#sidebar2{
    width:20%;
    height:65%;
    border:1px;
    margin-left:1.3%;
    margin-top:0.2%;
    margin-bottom:1%;
    float:left;
    background-color: #B0E0E6;
    overflow:scroll;
}
#sidebody2_1{
    width:67%;
    height:65%;
    border:1px;
    margin-left:2%;
    margin-top:0.2%;
    margin-bottom:1%;
    float:left;
    overflow:scroll;
}
#sidebody2_2{
    width:8.5%;
    height:65%;
    border:1px;
    margin-top:0.2%;
    margin-bottom:1%;
    float:left;
    overflow:hidden;
}
#clear{
    clear:both;
}
#footer{
    width:97.5%;
    height:60%;
    border:1px;
    margin-left:1.3%;
    margin-top:0.2%;
    margin-right:1%;
    margin-bottom:1%;
}
.content {
    max-width: 800px;
    margin: auto;
    padding: 16px 32px;
}
.header {
    text-align: center;
    padding: 32px 0;
}
.wrapper {
    width:100%;
    height: 100%;
    padding: 16px 0;
    position: relative;
}
.wrapper.col-2 {
    display: inline-block;
    min-height: 256px;
    width: 49%;
}
@media (max-width: 400px) {
    .wrapper.col-2 {
        width: 100%
    }
}
.wrapper canvas {
    -moz-user-select: none;
    -webkit-user-select: none;
    -ms-user-select: none;
}
table, td, th {    
    border: 1px solid #ddd;
    text-align: left;
    margin-left:35px;
}
th{
    height: 50px;
    text-align: left;
    border:1px;
}
td{
    text-align: left;
    background-color: #DDDDDD;
    border:1px;
}
tr:nth-child(even){background-color: #f2f2f2}

   #chartjs-tooltip {
       opacity: 1;
       position: absolute;
       background: rgba(0, 0, 0, .7);
       color: white;
       padding: 3px;
       border-radius: 3px;
       -webkit-transition: all .1s ease;
       transition: all .1s ease;
       pointer-events: none;
       -webkit-transform: translate(-50%, 0);
       transform: translate(-50%, 0);
   }
   #chartjs-tooltip.below {
       -webkit-transform: translate(-50%, 0);
       transform: translate(-50%, 0);
   }
   #chartjs-tooltip.below:before {
       border: solid;
       border-color: #111 transparent;
       border-color: rgba(0, 0, 0, .8) transparent;
       border-width: 0 8px 8px 8px;
       bottom: 1em;
       content:"";
       display: block;
       left: 50%;
       position: absolute;
       z-index: 99;
       -webkit-transform: translate(-50%, -100%);
       transform: translate(-50%, -100%);
   }
   #chartjs-tooltip.above {
       -webkit-transform: translate(-50%, -100%);
       transform: translate(-50%, -100%);
   }
   #chartjs-tooltip.above:before {
       border: solid;
       border-color: #111 transparent;
       border-color: rgba(0, 0, 0, .8) transparent;
       border-width: 8px 8px 0 8px;
       bottom: 1em;
       content:"";
       display: block;
       left: 50%;
       top: 100%;
       position: absolute;
       z-index: 99;
       -webkit-transform: translate(-50%, 0);
       transform: translate(-50%, 0);
   }
   .tabs {
    width:100%;
    display:inline-block;
}
 
    /*----- Tab Links -----*/
    /* Clearfix */
    .tab-links:after {
        display:block;
        clear:both;
        content:'';
    }
 
    .tab-links li {
        margin:0px 5px;
        float:left;
        list-style:none;
    }
 
        .tab-links a {
            padding:9px 15px;
            display:inline-block;
            border-radius:3px 3px 0px 0px;
            background:#7FB5DA;
            font-size:16px;
            font-weight:600;
            color:#4c4c4c;
            transition:all linear 0.15s;
        }
 
        .tab-links a:hover {
            background:#a7cce5;
            text-decoration:none;
        }
 
    li.active a, li.active a:hover {
        background:#fff;
        color:#4c4c4c;
    }
 
    /*----- Content of Tabs -----*/
    .tab-content {
        padding:15px;
        border-radius:3px;
         /*box-shadow:-1px 1px 1px rgba(0,0,0,0.15);*/
        background:#fff;
    }
 
    .tab {
        display:none;
    }
 
    .tab.active {
        display:block;
    }
   
</style>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<div class="w3-top">
    <div class="w3-bar w3-white w3-wide w3-padding w3-card-2">
        <a href="index.php" class="w3-bar-item w3-button"><b>NTUIOX</b>  UbiCompLab</a>
        <div class="w3-right w3-hi`de-small">
            <?php 
                session_start();
                $user_check=$_SESSION['login_user'];
                if($user_check == 'ioxubicomp'){
                    echo '<a href="upload/FinalTarget_Web_User.php" class="w3-bar-item w3-button">臉部辨識</a>';
                }
            ?>
            <!--
            <a href="#projects" class="w3-bar-item w3-button">Projects</a>
            <a href="#about" class="w3-bar-item w3-button">About</a>
            <a href="#contact" class="w3-bar-item w3-button">Contact</a>
            -->
            <a href="dropout_index" class="w3-bar-item w3-button">Dropout</a>
            <a href="logout.php" class="w3-bar-item w3-button">Logout</a>
        </div>
    </div>
</div>
<div>
    <div id="projects" style="background-color: #112F5F; height: 105px; width: 97.5%; margin-left:1.3%;">
        <h2><FONT COLOR=white>SoberMotion</FONT></h2>
        <h3><FONT COLOR=white>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SoberMotion</FONT></h3>
    </div>
</div>

<div id="container">
    <div id="headbox" style="padding:2%;text-align:center;">
        <?php
            //echo "<h1>Hello " . $_GET["val"] . "</h1>";
            echo '<p id="userid" style="font-size:20px">'.$_GET["val1"].'</p>';
            echo '<hr size="1%" align="center" width="100%">';
            echo '<p><font size="2%">第'.$_GET["val2"].'月 第'.$_GET["val3"].'週<br>達標進度 '.$_GET["val4"].'分</font></p>';
        ?>
        <!--
        <p><font size="5%">個案1</font></p>
        <hr size="1%" align="center" width="100%">
        <p><font size="2%">第2月 第1週<br>達標進度 100%</font></p>
        -->
    </div>
    <div id="sidebar" style="padding:5%;text-align:center;">
        <p><font size="15">飲<br>酒<br>行<br>為<br></font></p>
    </div>
    <div id="sidebody_1">
        <div>
            <button type="button" onclick="showall_brac()" style="border-radius:5px;background-color:white;text-align:center;font-size:9px;border:1px#e7e7e7 solid;"><b>所有</b></button>
            <select id="month1" onclick="dataupdate()">
            <option value="1">第一月</option>
            <option value="2">第二月</option>
            <option value="3">第三月</option>
            </select> 
            <select id="week1" onclick="dataupdate()">
            <option value="1">第一週</option>
            <option value="2">第二週</option>
            <option value="3">第三週</option>
            <option value="4">第四週</option>
            </select> 
        </div>
        <div class="wrapper">
            <canvas id="chart-0"></canvas>
        </div>   
    </div>
    <div id="sidebody_2" align="left">
        <br><br>共 <span id="interval"></span> 次喝酒<br>
        <form id="chk" name="chkbox" action = "#">
            <input type="checkbox" name="chk0" style="zoom:1.2" onclick = "chk0update()" checked>
            工作提神 <font color="#FF0000" size=3px>●</font><br>
            <input type="checkbox" name="chk1" style="zoom:1.2" onclick = "chk1update()" checked>
            交際應酬 <font color="#FF8800" size=3px>●</font><br>
            <input type="checkbox" name="chk2" style="zoom:1.2" onclick = "chk2update()" checked>
            幫助睡眠 <font color="#EEEE00" size=3px>●</font><br>
            <input type="checkbox" name="chk3" style="zoom:1.2" onclick = "chk3update()" checked>
            無聊 <font color="#00FF00" size=3px>●</font><br>
            <input type="checkbox" name="chk4" style="zoom:1.2" onclick = "chk4update()" checked>
            別人勸酒 <font color="#00FFFF" size=3px>●</font><br>
            <input type="checkbox" name="chk5" style="zoom:1.2" onclick = "chk5update()" checked>
            親友聚餐 <font color="#0000FF" size=3px>●</font><br>
            <input type="checkbox" name="chk6" style="zoom:1.2" onclick = "chk6update()" checked>
            親友吵架 <font color="#7700FF" size=3px>●</font><br>
            <input type="checkbox" name="chk7" style="zoom:1.2" onclick = "chk7update()" checked>
            鬱卒 <font color="#FF00FF" size=3px>●</font><br>
            <input type="checkbox" name="chk8" style="zoom:1.2" onclick = "chk8update()" checked>
            其他 <font color="#000000" size=3px>●</font><br>
            <input type="checkbox" name="chk9" style="zoom:1.2" onclick = "chk9update()" checked>
            沒填理由 <font color="#888888" size=3px>●</font><br>
        </form>  
    </div>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
    <script>

        //query database
        var userid = document.getElementById("userid").innerHTML;
        var brac = [];
        var brac_backup = [];
        var time = [];
        var reason = [];
        var reason_string = [];
        var interval;
        var drink = 0;

        var m = document.getElementById("month1");
        var month = m.options[m.selectedIndex].value;
        var w = document.getElementById("week1");
        var week = w.options[w.selectedIndex].value;

        var ALL = true;

        $.ajax({
            type: 'post',
            url: 'get_brac_data.php',
            data: "userid="+ userid,
            dataType: 'json',
            async: false,
            success: function(response) {
            //here I'd like back the php query
                interval = response.length;
                for (var i = 0; i < interval; i++){
                    if (response[i].brac >= 0.14)
                        drink++;
                    brac.push(response[i].brac);
                    brac_backup.push(response[i].brac);
                    time.push(response[i].time);
                    reason.push(response[i].reason);
                    reason_string.push(response[i].reason_string);
                }
            }
        });
        document.getElementById('interval').innerHTML = drink;


        var presets = window.chartColors;

        var inputs = {
            min: 0,
            max: 1,
            count: interval,
            decimals: 2,
            continuity: 1
        };

        // fill in color
        var pointBackgroundColors = [];

        document.chkbox.chk0.disabled = true;
        document.chkbox.chk1.disabled = true;
        document.chkbox.chk2.disabled = true;
        document.chkbox.chk3.disabled = true;
        document.chkbox.chk4.disabled = true;
        document.chkbox.chk5.disabled = true;
        document.chkbox.chk6.disabled = true;
        document.chkbox.chk7.disabled = true;
        document.chkbox.chk8.disabled = true;
        document.chkbox.chk9.disabled = true;

        for (i = 0; i < interval; i++) {
            switch(reason[i]){
                case "0":
                    pointBackgroundColors.push("#FF0000");
                    document.chkbox.chk0.disabled = false;
                    break;
                case "1":
                    pointBackgroundColors.push("#FF8800");
                    document.chkbox.chk1.disabled = false;
                    break;
                case "2":
                    pointBackgroundColors.push("#EEEE00");
                    document.chkbox.chk2.disabled = false;
                    break;
                case "3":
                    pointBackgroundColors.push("#00FF00");
                    document.chkbox.chk3.disabled = false;
                    break;
                case "4":
                    pointBackgroundColors.push("#00FFFF");
                    document.chkbox.chk4.disabled = false;
                    break;
                case "5":
                    pointBackgroundColors.push("#0000FF");
                    document.chkbox.chk5.disabled = false;
                    break;
                case "6":
                    pointBackgroundColors.push("#7700FF");
                    document.chkbox.chk6.disabled = false;
                    break;
                case "7":
                    pointBackgroundColors.push("#FF00FF");
                    document.chkbox.chk7.disabled = false;
                    break;
                case "8":
                    pointBackgroundColors.push("#000000");
                    document.chkbox.chk8.disabled = false;
                    break;
                case "9":
                    pointBackgroundColors.push("#888888");
                    document.chkbox.chk9.disabled = false;
                    break;
            }
        }

        var horizonalLinePlugin = {
            afterDraw: function(chartInstance) {
                var yValue;
                var yScale = chartInstance.scales["y-axis-0"];
                var canvas = chartInstance.chart;
                var ctx = canvas.ctx;
                var index;
                var line;
                var style;

                if (chartInstance.options.horizontalLine) {
                    for (index = 0; index < chartInstance.options.horizontalLine.length; index++) {
                        line = chartInstance.options.horizontalLine[index];

                        if (!line.style) {
                          style = "rgba(169,169,169, .6)";
                        } else {
                          style = line.style;
                        }

                        if (line.y) {
                          yValue = yScale.getPixelForValue(line.y);
                        } else {
                          yValue = 0;
                        }

                        ctx.lineWidth = 3;

                        if (yValue) {
                          ctx.beginPath();
                          ctx.moveTo(0, yValue);
                          ctx.lineTo(canvas.width, yValue);
                          ctx.strokeStyle = style;
                          ctx.stroke();
                        }

                        if (line.text) {
                          ctx.fillStyle = style;
                          ctx.fillText(line.text, 0, yValue + ctx.lineWidth);
                        }
                    }
                    return;
                }
            }
        };
        Chart.pluginService.register(horizonalLinePlugin);



        var data = {
            labels: time,
            datasets: [{
                //backgroundColor: utils.transparentize(presets.red),
                fill: false,
                //borderColor: presets.red,
                data: brac,
                pointBackgroundColor: pointBackgroundColors,
                hidden: false,
                label: '酒精值Brac'
            }]
        };

        var options = {
            maintainAspectRatio: false,
            spanGaps: true,
	        legend: {
                display: false
   	        },
            tooltips: {
                mode: 'label',
                callbacks: {
                    label: function(tooltipItem, data) {
                        var d;
                        switch(reason[tooltipItem['index']]){
                            case "0":
                                d = "工作提神";
                                break;
                            case "1":
                                d = "交際應酬";
                                break;
                            case "2":
                                d = "幫助睡眠";
                                break;
                            case "3":
                                d = "無聊";
                                break;
                            case "4":
                                d = "別人勸酒";
                                break;
                            case "5":
                                d = "親友聚餐";
                                break;
                            case "6":
                                d = "親友吵架";
                                break;
                            case "7":
                                d = "鬱卒";
                                break;
                            case "8":
                                d = reason_string[tooltipItem['index']];
                                break;
                            case "9":
                                d = "沒填理由";
                                break;
                            defaults:
                                d = "--";
                                break;
                        }
                        d = "原因: " + d;
                        return [data['datasets'][0]['data'][tooltipItem['index']], d];
                    }
                }
            },
            elements: {
                line: {
                    tension: 0.000001
                }
            },
            scales: {
                yAxes: [{
                    stacked: true,
		            scaleLabel: {
                                display: true,
                                labelString: '酒精值'
                    },
		        ticks: {
                           beginAtZero: true,
                           stepValue: 0.05,
                           max: 1
                   }
		        }]
            },
            plugins: {
                filler: {
                    propagate: false
                },
                samples_filler_analyser: {
                    target: 'chart-analyser'
                }
            },/*
            animation: {
                duration: 1,
                onComplete: function () {
                    var chartInstance = this.chart,
                        ctx = chartInstance.ctx;
                    ctx.font = Chart.helpers.fontString(Chart.defaults.global.defaultFontSize, Chart.defaults.global.defaultFontStyle, Chart.defaults.global.defaultFontFamily);
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'bottom';

                    this.data.datasets.forEach(function (dataset, i) {
                        var meta = chartInstance.controller.getDatasetMeta(i);
                        meta.data.forEach(function (bar, index) {
                            var data = reason_string[index];
                            //if (data == null){
                            //    data = '';
                            //}                            
                            ctx.fillText(data, bar._model.x, bar._model.y);
                        });
                    });

                }
            },*/
            "horizontalLine": [{
              "y": 0.15,
              "style": "rgba(255, 0, 0, .4)",
              "text": "0.15"
            }]
        };



        var chart = new Chart('chart-0', {
            type: 'line',
            data: data,
            options: options
        });

        // checkbox control
        function chk0update(){     
            if(document.chkbox.chk0.checked == false){       
                for (var i = 0; i < interval; i++){
                    if(reason[i] == 0){
                        brac[i] = null;
                    }
                }
            } else{
                for (var i = 0; i < interval; i++){
                    if(reason[i] == 0){
                        brac[i] = brac_backup[i];
                    }
                }
            }
            chart.update();
        }   
        function chk1update(){     
            if(document.chkbox.chk1.checked == false){ 
                for (var i = 0; i < interval; i++){
                    if(reason[i] == 1){
                        brac[i] = null;
                    }
                }
            } else{
                //打勾
                for (var i = 0; i < interval; i++){
                    if(reason[i] == 1){
                        brac[i] = brac_backup[i];
                    }
                }
            }
            chart.update();
        }  
        function chk2update(){     
            if(document.chkbox.chk2.checked == false){       
                for (var i = 0; i < interval; i++){
                    if(reason[i] == 2){
                        brac[i] = null;
                    }
                }
            } else{
                for (var i = 0; i < interval; i++){
                    if(reason[i] == 2){
                        brac[i] = brac_backup[i];
                    }
                }
            }
            chart.update(); 
        }  
        function chk3update(){     
            if(document.chkbox.chk3.checked == false){       
                for (var i = 0; i < interval; i++){
                    if(reason[i] == 3){
                        brac[i] = null;
                    }
                }
            } else{
                for (var i = 0; i < interval; i++){
                    if(reason[i] == 3){
                        brac[i] = brac_backup[i];
                    }
                }
            }
            chart.update();
        }  
        function chk4update(){     
            if(document.chkbox.chk4.checked == false){       
                for (var i = 0; i < interval; i++){
                    if(reason[i] == 4){
                        brac[i] = null;
                    }
                }
            } else{
                for (var i = 0; i < interval; i++){
                    if(reason[i] == 4){
                        brac[i] = brac_backup[i];
                    }
                }
            }
            chart.update();  
        }  
        function chk5update(){     
            if(document.chkbox.chk5.checked == false){       
                for (var i = 0; i < interval; i++){
                    if(reason[i] == 5){
                        brac[i] = null;
                    }
                }
            } else{
                for (var i = 0; i < interval; i++){
                    if(reason[i] == 5){
                        brac[i] = brac_backup[i];
                    }
                }  
            }
            chart.update();   
        }  
        function chk6update(){     
            if(document.chkbox.chk6.checked == false){       
                for (var i = 0; i < interval; i++){
                    if(reason[i] == 6){
                        brac[i] = null;
                    }
                }
            } else{
                for (var i = 0; i < interval; i++){
                    if(reason[i] == 6){
                        brac[i] = brac_backup[i];
                    }
                }
            }
            chart.update();
        }  
        function chk7update(){     
            if(document.chkbox.chk7.checked == false){       
                for (var i = 0; i < interval; i++){
                    if(reason[i] == 7){
                        brac[i] = null;
                    }
                }
            } else{
                for (var i = 0; i < interval; i++){
                    if(reason[i] == 7){
                        brac[i] = brac_backup[i];
                    }
                }
            }
            chart.update();
        } 
        function chk8update(){     
            if(document.chkbox.chk8.checked == false){       
                for (var i = 0; i < interval; i++){
                    if(reason[i] == 8){
                        brac[i] = null;
                    }
                }
            } else{
                for (var i = 0; i < interval; i++){
                    if(reason[i] == 8){
                        brac[i] = brac_backup[i];
                    }
                }
            }
            chart.update();  
        }  
        function chk9update(){     
            if(document.chkbox.chk9.checked == false){       
                for (var i = 0; i < interval; i++){
                    if(reason[i] == 9){
                        brac[i] = null;
                    }
                }
            } else{
                for (var i = 0; i < interval; i++){
                    if(reason[i] == 9){
                        brac[i] = brac_backup[i];
                    }
                }
            } 
            chart.update();
        } 
        function dataupdate(){
            brac = [];
            brac_backup = [];
            time = [];
            reason = [];
            reason_string = [];
            pointBackgroundColors = [];
            var e = document.getElementById("month1");
            month = e.options[e.selectedIndex].value;
            e = document.getElementById("week1");
            week = e.options[e.selectedIndex].value;

            $.ajax({
                type: 'post',
                url: 'get_brac_data_time.php',
                data: {userid: userid, month: month, week: week},
                dataType: 'json',
                async: false,
                success: function(response) {
                //here I'd like back the php query
                    interval = response.length;
                    for (var i = 0; i < interval; i++){
                        brac.push(response[i].brac);
                        brac_backup.push(response[i].brac);
                        time.push(response[i].time);
                        reason.push(response[i].reason);
                        reason_string.push(response[i].reason_string);
                    }
                }
            });
            document.getElementById('interval').innerHTML = interval;
            document.getElementById("chk").checked = true;
            document.chkbox.chk0.disabled = true;
            document.chkbox.chk1.disabled = true;
            document.chkbox.chk2.disabled = true;
            document.chkbox.chk3.disabled = true;
            document.chkbox.chk4.disabled = true;
            document.chkbox.chk5.disabled = true;
            document.chkbox.chk6.disabled = true;
            document.chkbox.chk7.disabled = true;
            document.chkbox.chk8.disabled = true;
            document.chkbox.chk9.disabled = true;
            for (i = 0; i < interval; i++) {
                switch(reason[i]){
                    case "0":
                        pointBackgroundColors.push("#FF0000");
                        document.chkbox.chk0.disabled = false;
                        break;
                    case "1":
                        pointBackgroundColors.push("#FF8800");
                        document.chkbox.chk1.disabled = false;
                        break;
                    case "2":
                        pointBackgroundColors.push("#EEEE00");
                        document.chkbox.chk2.disabled = false;
                        break;
                    case "3":
                        pointBackgroundColors.push("#00FF00");
                        document.chkbox.chk3.disabled = false;
                        break;
                    case "4":
                        pointBackgroundColors.push("#00FFFF");
                        document.chkbox.chk4.disabled = false;
                        break;
                    case "5":
                        pointBackgroundColors.push("#0000FF");
                        document.chkbox.chk5.disabled = false;
                        break;
                    case "6":
                        pointBackgroundColors.push("#7700FF");
                        document.chkbox.chk6.disabled = false;
                        break;
                    case "7":
                        pointBackgroundColors.push("#FF00FF");
                        document.chkbox.chk7.disabled = false;
                        break;
                    case "8":
                        pointBackgroundColors.push("#000000");
                        document.chkbox.chk8.disabled = false;
                        break;
                    case "9":
                        pointBackgroundColors.push("#888888");
                        document.chkbox.chk9.disabled = false;
                        break;
                }
            }
            updatechart();
        }
        function showall_brac(){
            brac = [];
            brac_backup = [];
            time = [];
            reason = [];
            reason_string = [];
            pointBackgroundColors = [];
            $.ajax({
                type: 'post',
                url: 'get_brac_data.php',
                data: "userid="+ userid,
                dataType: 'json',
                async: false,
                success: function(response) {
                    interval = response.length;
                    for (var i = 0; i < interval; i++){
                        brac.push(response[i].brac);
                        brac_backup.push(response[i].brac);
                        time.push(response[i].time);
                        reason.push(response[i].reason);
                        reason_string.push(response[i].reason_string);
                    }
                }
            });
            document.getElementById('interval').innerHTML = interval;
            document.chkbox.chk0.disabled = true;
            document.chkbox.chk1.disabled = true;
            document.chkbox.chk2.disabled = true;
            document.chkbox.chk3.disabled = true;
            document.chkbox.chk4.disabled = true;
            document.chkbox.chk5.disabled = true;
            document.chkbox.chk6.disabled = true;
            document.chkbox.chk7.disabled = true;
            document.chkbox.chk8.disabled = true;
            document.chkbox.chk9.disabled = true;
            for (i = 0; i < interval; i++) {
                switch(reason[i]){
                    case "0":
                        pointBackgroundColors.push("#FF0000");
                        document.chkbox.chk0.disabled = false;
                        document.chkbox.chk0.checked = true;
                        break;
                    case "1":
                        pointBackgroundColors.push("#FF8800");
                        document.chkbox.chk1.disabled = false;
                        document.chkbox.chk1.checked = true;
                        break;
                    case "2":
                        pointBackgroundColors.push("#EEEE00");
                        document.chkbox.chk2.disabled = false;
                        document.chkbox.chk2.checked = true;
                        break;
                    case "3":
                        pointBackgroundColors.push("#00FF00");
                        document.chkbox.chk3.disabled = false;
                        document.chkbox.chk3.checked = true;
                        break;
                    case "4":
                        pointBackgroundColors.push("#00FFFF");
                        document.chkbox.chk4.disabled = false;
                        document.chkbox.chk4.checked = true;
                        break;
                    case "5":
                        pointBackgroundColors.push("#0000FF");
                        document.chkbox.chk5.disabled = false;
                        document.chkbox.chk5.checked = true;
                        break;
                    case "6":
                        pointBackgroundColors.push("#7700FF");
                        document.chkbox.chk6.disabled = false;
                        document.chkbox.chk6.checked = true;
                        break;
                    case "7":
                        pointBackgroundColors.push("#FF00FF");
                        document.chkbox.chk7.disabled = false;
                        document.chkbox.chk7.checked = true;
                        break;
                    case "8":
                        pointBackgroundColors.push("#000000");
                        document.chkbox.chk8.disabled = false;
                        document.chkbox.chk8.checked = true;
                        break;
                    case "9":
                        pointBackgroundColors.push("#888888");
                        document.chkbox.chk9.disabled = false;
                        document.chkbox.chk9.checked = true;
                        break;
                }
            }
            updatechart();
        }
        function updatechart(){
            chart.destroy();
            data = {
                labels: time,
                datasets: [{
                    //backgroundColor: utils.transparentize(presets.red),
                    fill: false,
                    //borderColor: presets.red,
                    data: brac,
                    pointBackgroundColor: pointBackgroundColors,
                    hidden: false,
                    label: '酒精值Brac'
                }]
            };
            options = {
                maintainAspectRatio: false,
                spanGaps: true,
                legend: {
        		display: false
    		},
            tooltips: {
                mode: 'label',
                callbacks: {
                    label: function(tooltipItem, data) {
                        var d;
                        switch(reason[tooltipItem['index']]){
                            case "0":
                                d = "工作提神";
                                break;
                            case "1":
                                d = "交際應酬";
                                break;
                            case "2":
                                d = "幫助睡眠";
                                break;
                            case "3":
                                d = "無聊";
                                break;
                            case "4":
                                d = "別人勸酒";
                                break;
                            case "5":
                                d = "親友聚餐";
                                break;
                            case "6":
                                d = "親友吵架";
                                break;
                            case "7":
                                d = "鬱卒";
                                break;
                            case "8":
                                d = reason_string[tooltipItem['index']];
                                break;
                            case "9":
                                d = "沒填理由";
                                break;
                            defaults:
                                d = "--";
                                break;
                        }
                        d = "原因: " + d;
                        return [data['datasets'][0]['data'][tooltipItem['index']], d];
                    }
                }
            },
		elements: {
                    line: {
                        tension: 0.000001
                    }
                },
                scales: {
                    yAxes: [{
                    	stacked: true,
                    	scaleLabel: {
                                display: true,
                                labelString: '酒精值'
                    	},
                    	ticks: {
                           beginAtZero: true,
                           stepValue: 0.05,
                           max: 1
                   	}
                     }]
            	},
                plugins: {
                    filler: {
                        propagate: false
                    },
                    samples_filler_analyser: {
                        target: 'chart-analyser'
                    }
                },/*
                animation: {
                    duration: 1,
                    onComplete: function () {
                        var chartInstance = this.chart,
                            ctx = chartInstance.ctx;
                        ctx.font = Chart.helpers.fontString(Chart.defaults.global.defaultFontSize, Chart.defaults.global.defaultFontStyle, Chart.defaults.global.defaultFontFamily);
                        ctx.textAlign = 'center';
                        ctx.textBaseline = 'bottom';

                        this.data.datasets.forEach(function (dataset, i) {
                            var meta = chartInstance.controller.getDatasetMeta(i);
                            meta.data.forEach(function (bar, index) {
                                var data = reason_string[index]; 
                                //if (data == null){
                                //    data = '';
                                //}                            
                                ctx.fillText(data, bar._model.x, bar._model.y);
                            });
                        });
                    }
                },*/
                "horizontalLine": [{
                  "y": 0.15,
                  "style": "rgba(255, 0, 0, .4)",
                  "text": "0.15"
                }]
            };
            chart = new Chart('chart-0', {
                type: 'line',
                data: data,
                options: options
            });
            
        }

    </script>
    <div id="sidebar2" style="padding:6.5%;text-align:center;">
        <p><font size="15">低<br>估<br>比<br>率<br></font></p>
    </div>
    <div id="sidebody2_1">
        <div class="wrapper">
            <canvas id="canvas"></canvas>
        </div> 
    </div>
    <div id="sidebody2_2" align="left">
        ▼每月低估比例
        <!--
        <br><br>●第一個月低估比例:<span id="month1"></span>  %
        <br><br>●第二個月低估比例:<span id="month2"></span>  %
        <br><br>●第三個月低估比例:<span id="month3"></span>  %
        -->
        <div class="wrapper">
            <canvas id="canvas1" style="border:1px; width:100%; height: 28%"></canvas>
            <canvas id="canvas2" style="border:1px; width:100%; height: 28%"></canvas>
            <canvas id="canvas3" style="border:1px; width:100%; height: 28%"></canvas>
        </div> 

    </div>
    <script>
        var userid = document.getElementById("userid").innerHTML;
        var weeks = ["第1週", "第2週", "第3週", "第4週", "第5週", "第6週", "第7週", "第8週", "第9週", "第10週", "第11週","第12週"];
        var percent = [];
        var num = [];
        var len;
        $.ajax({
            type: 'post',
            url: 'underestimate.php',
            data: "userid="+ userid,
            dataType: 'json',
            async: false,
            success: function(response) {
            //here I'd like back the php query
                len = response.length;
                for (var i = 0; i < len; i++){
                    percent.push(response[i].percent);
                    num.push(response[i].num);
                }
            }
        });


        var color = Chart.helpers.color;
        var barChartData = {
            labels: weeks,
            datasets: [{
                label: '低估比例 ％',
                backgroundColor: color(window.chartColors.red).alpha(0.5).rgbString(),
                borderColor: window.chartColors.red,
                borderWidth: 1,
                data: percent
            }]
        };

        var opt = {
            events: false,
            tooltips: {
                enabled: false
            },
	    legend: {
        	display: false
    	    },
	    scales: {
                yAxes: [{
                    stacked: true,
                    scaleLabel: {
                                display: true,
                                labelString: '低估比例'
                    },
                    ticks: {
                           beginAtZero: true,
                           stepValue: 5,
                           max: 100
                   }
                }]
            },
            hover: {
                animationDuration: 0
            },
            animation: {
                duration: 1,
                onComplete: function () {
                    var chartInstance = this.chart,
                        ctx = chartInstance.ctx;
                    ctx.font = Chart.helpers.fontString(Chart.defaults.global.defaultFontSize, Chart.defaults.global.defaultFontStyle, Chart.defaults.global.defaultFontFamily);
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'bottom';

                    this.data.datasets.forEach(function (dataset, i) {
                        var meta = chartInstance.controller.getDatasetMeta(i);
                        meta.data.forEach(function (bar, index) {
                            var data = dataset.data[index]; 
                            //console.log(num[index]);                    
                            ctx.fillText(data+'%\n'+num[index], bar._model.x, bar._model.y+7);
                        });
                    });
                }
            }
        };

        window.onload = function() {
            var ctx = document.getElementById("canvas").getContext("2d");
            window.myBar = new Chart(ctx, {
                type: 'bar',
                data: barChartData,
                options: opt
            });
        };

        //////////////////
        /////////////////
        ////////////////
        
        /*
        Chart.pluginService.register({
            afterUpdate: function (chart) {
                if (chart.config.options.elements.arc.roundedCornersFor !== undefined) {
                    var arc = chart.getDatasetMeta(0).data[chart.config.options.elements.arc.roundedCornersFor];
                    arc.round = {
                        x: (chart.chartArea.left + chart.chartArea.right) / 2,
                        y: (chart.chartArea.top + chart.chartArea.bottom) / 2,
                        radius: (chart.outerRadius + chart.innerRadius) / 2,
                        thickness: (chart.outerRadius - chart.innerRadius) / 2 - 1,
                        backgroundColor: arc._model.backgroundColor
                    }
                }
            },
            afterDraw: function (chart) {
                if (chart.config.options.elements.arc.roundedCornersFor !== undefined) {
                    var ctx2_1 = chart.chart.ctx;
                    var arc = chart.getDatasetMeta(0).data[chart.config.options.elements.arc.roundedCornersFor];
                    var startAngle = Math.PI / 2 - arc._view.startAngle;
                    var endAngle = Math.PI / 2 - arc._view.endAngle;

                    ctx2_1.save();
                    ctx2_1.translate(arc.round.x, arc.round.y);
                    ctx2_1.fillStyle = arc.round.backgroundColor;
                    ctx2_1.beginPath();
                    ctx2_1.arc(arc.round.radius * Math.sin(startAngle), arc.round.radius * Math.cos(startAngle), arc.round.thickness, 0, 2 * Math.PI);
                    ctx2_1.arc(arc.round.radius * Math.sin(endAngle), arc.round.radius * Math.cos(endAngle), arc.round.thickness, 0, 2 * Math.PI);
                    ctx2_1.closePath();
                    ctx2_1.fill();
                    ctx2_1.restore();
                }
            },
        });
        */

        // write text plugin
        Chart.pluginService.register({
            afterUpdate: function (chart) {
                if (chart.config.options.elements.center) {
                    var helpers = Chart.helpers;
                    var centerConfig = chart.config.options.elements.center;
                    var globalConfig = Chart.defaults.global;
                    var ctx2_1 = chart.chart.ctx;
            
                    var fontStyle = helpers.getValueOrDefault(centerConfig.fontStyle, globalConfig.defaultFontStyle);
                    var fontFamily = helpers.getValueOrDefault(centerConfig.fontFamily, globalConfig.defaultFontFamily);

                    if (centerConfig.fontSize)
                        var fontSize = centerConfig.fontSize;
                        // figure out the best font size, if one is not specified
                    else {
                        ctx2_1.save();
                        var fontSize = helpers.getValueOrDefault(centerConfig.minFontSize, 1);
                        var maxFontSize = helpers.getValueOrDefault(centerConfig.maxFontSize, 256);
                        var maxText = helpers.getValueOrDefault(centerConfig.maxText, centerConfig.text);

                        do {
                            ctx2_1.font = helpers.fontString(fontSize, fontStyle, fontFamily);
                            var textWidth = ctx2_1.measureText(maxText).width;

                            // check if it fits, is within configured limits and that we are not simply toggling back and forth
                            if (textWidth < chart.innerRadius * 2 && fontSize < maxFontSize)
                                fontSize += 1;
                            else {
                                // reverse last step
                                fontSize -= 1;
                                break;
                            }
                        } while (true)
                        ctx2_1.restore();
                    }

                    // save properties
                    chart.center = {
                        font: helpers.fontString(fontSize, fontStyle, fontFamily),
                        fillStyle: helpers.getValueOrDefault(centerConfig.fontColor, globalConfig.defaultFontColor)
                    };
                }
            },
            afterDraw: function (chart) {
                if (chart.center) {
                    var ctx2_1 = chart.chart.ctx;
                    var i,a,s;
                    var n = chart;
                    var total = n.data.datasets[0].data[0] + '%';
                    /*
                    for(i=0,a=(n.data.datasets||[]).length;a>i;++i){
                        s = n.getDatasetMeta(i);
                        var x;
                                for(x=0; x<s.data.length; x++){
                            if (!s.data[x].hidden)
                            total += n.data.datasets[i].data[x];
                    }
                    }
                    */
                    ctx2_1.save();
                    ctx2_1.font = chart.center.font;
                    ctx2_1.fillStyle = chart.center.fillStyle;
                    ctx2_1.textAlign = 'center';
                    ctx2_1.textBaseline = 'middle';
                    var centerX = (chart.chartArea.left + chart.chartArea.right) / 2;
                    var centerY = (chart.chartArea.top + chart.chartArea.bottom) / 2;
                    ctx2_1.fillText(total, centerX, centerY);
                    ctx2_1.restore();
                }
            },
        })

        var first_month = (percent[0] + percent[1] + percent[2] + percent[3]) / 4;
        var second_month = (percent[4] + percent[5] + percent[6] + percent[7]) / 4;
        var third_month = (percent[8] + percent[9] + percent[10] + percent[11]) / 4;

        var config1 = {
            type: 'doughnut',
            data: {
                labels: [
                    "低估比率",
                    ""
                ],
                datasets: [{
                    data: [first_month, 100-first_month],
                    backgroundColor: [
                        "#FF6684",
                        "#ccc"
                    ],
                    hoverBackgroundColor: [
                        "#FF6384",
                        "#ccc"
                    ]
                }]
            },
            options: {
                elements: {
                    arc: {
                        roundedCornersFor: 0
                    },
                    center: {
                        maxText: '100%',
                        fontColor: '#FF6684',
                        fontFamily: "'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",
                        fontStyle: 'normal',
                        minFontSize: 1,
                        maxFontSize: 256,
                    }
                },
                legend: {
                    display: false
                },
                tooltips: {
                    enabled: false
                }
            }
        };
        var config2 = {
            type: 'doughnut',
            data: {
                labels: [
                    "低估比率",
                    ""
                ],
                datasets: [{
                    data: [second_month, 100-second_month],
                    backgroundColor: [
                        "#FF6684",
                        "#ccc"
                    ],
                    hoverBackgroundColor: [
                        "#FF6384",
                        "#ccc"
                    ]
                }]
            },
            options: {
                elements: {
                    arc: {
                        roundedCornersFor: 0
                    },
                    center: {
                        maxText: '100%',
                        fontColor: '#FF6684',
                        fontFamily: "'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",
                        fontStyle: 'normal',
                        minFontSize: 1,
                        maxFontSize: 256,
                    }
                },
                legend: {
                    display: false
                },
                tooltips: {
                    enabled: false
                }
            }
        };
        var config3 = {
            type: 'doughnut',
            data: {
                labels: [
                    "低估比率",
                    ""
                ],
                datasets: [{
                    data: [third_month, 100-third_month],
                    backgroundColor: [
                        "#FF6684",
                        "#ccc"
                    ],
                    hoverBackgroundColor: [
                        "#FF6384",
                        "#ccc"
                    ]
                }]
            },
            options: {
                elements: {
                    arc: {
                        roundedCornersFor: 0
                    },
                    center: {
                        maxText: '100%',
                        fontColor: '#FF6684',
                        fontFamily: "'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",
                        fontStyle: 'normal',
                        minFontSize: 1,
                        maxFontSize: 256,
                    }
                },
                legend: {
                    display: false
                },
                tooltips: {
                    enabled: false
                }
            }
        };
        var ctx2_1 = document.getElementById("canvas1").getContext("2d");
        var myChart = new Chart(ctx2_1, config1);
        var ctx2_2 = document.getElementById("canvas2").getContext("2d");
        var myChart = new Chart(ctx2_2, config2);
        var ctx2_3 = document.getElementById("canvas3").getContext("2d");
        var myChart = new Chart(ctx2_3, config3);

    </script>
    <div id="clear">
    </div>
    <!--
    <div id="footer" style="text-align:center;">
        <p style="font-size:20px">總覽</p>
        <div style="text-align:left; margin-left:5%;">
            <button type="button" onclick="showall()" style="border-radius:5px;background-color:white;text-align:center;font-size:9px;border:1px#e7e7e7 solid;"><b>所有</b></button>
            <select id="month" onclick="querydata()">
                <option value="1">第一月</option>
                <option value="2">第二月</option>
                <option value="3">第三月</option>
            </select> 
            <select id="week" onclick="querydata()">
                <option value="1">第一週</option>
                <option value="2">第二週</option>
                <option value="3">第三週</option>
                <option value="4">第四週</option>
            </select> 
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button id="notdrink" type="button" onclick="notdrink()" style="border-radius:5px;background-color:white;text-align:center;font-size:9px;border:1px#e7e7e7 solid;"><b>沒喝酒</b></button>
            <button id="drink" type="button" onclick="drink()" onclick="foo()" style="border-radius:5px;background-color:white;text-align:center;font-size:9px;border:1px#e7e7e7 solid;"><b>有喝酒</b></button>
            <button id="notselfdrive" type="button" onclick="notselfdrive()" style="border-radius:5px;background-color:white;text-align:center;font-size:9px;border:1px#e7e7e7 solid;"><b>非自駕</b></button>
            <button id="selfdrive" type="button" onclick="selfdrive()" style="border-radius:5px;background-color:white;text-align:center;font-size:9px;border:1px#e7e7e7 solid;"><b>自駕</b></button>
            <button id="notreport" type="button" onclick="notreport()" style="border-radius:5px;background-color:white;text-align:center;font-size:9px;border:1px#e7e7e7 solid;"><b>未回報</b></button>
        </div>
        <br>
        <table border="1" width="100%" id="table">
            <tbody>
            <tr>
                <th width="12.5%">事件▽</th>
                <th width="12.5%">日期▽</th>
                <th width="12.5%">時間▽</th>
                <th width="12.5%">酒測值▽</th>
                <th width="12.5%">喝酒原因▽</th>
                <th width="12.5%">人臉辨識結果▽</th>
                <th width="12.5%">距離上次<br>酒測時間(小時)▽</th>
                <th width="12.5%">駕駛時間<br>長度(分鐘)▽</th>
            </tr>
            </tbody>
        </table>
    </div>
    
    <script>
        var t = document.getElementById("table");
        var drinking = []; //有喝酒
        var notdrinking = []; //沒喝酒
        var selfdriving = []; //自駕
        var nonselfdriving = []; //非自駕
        var nonreporting = []; //未回報
        
        var all_drinking = []; //有喝酒
        var all_notdrinking = []; //沒喝酒
        var all_selfdriving = []; //自駕
        var all_nonselfdriving = []; //非自駕
        var all_nonreporting = []; //未回報

        var all = [];

        var m = document.getElementById("month");
        var month = m.options[m.selectedIndex].value;
        var w = document.getElementById("week");
        var week = w.options[w.selectedIndex].value;
        var ALL = true;

        $.ajax({
            type: 'post',
            url: 'get_alcohol_data.php',
            data: "userid="+ userid,
            dataType: 'json',
            async: false,
            success: function(response) {
                len = response.length;
                for (var i = 0; i < len; i++){
                    if (response[i].brac > 0.06){
                        all_drinking.push("--");
                        all_drinking.push("--");
                        if (response[i].finaltarget != userid){
                            all_drinking.push("非本人");
                        } else{
                            all_drinking.push("--");
                        }
                        all_drinking.push(response[i].reason);
                        all_drinking.push(response[i].brac);
                        all_drinking.push(response[i].time);
                        all_drinking.push(response[i].date);
                        all_drinking.push("有喝酒"); 
                        //
                        all.push("--");
                        all.push("--");
                        if (response[i].finaltarget != userid){
                            all.push("非本人");
                        } else{
                            all.push("--");
                        }
                        all.push(response[i].reason);
                        all.push(response[i].brac);
                        all.push(response[i].time);
                        all.push(response[i].date);
                        all.push("有喝酒");   
                    } else {
                        all_notdrinking.push("--");
                        all_notdrinking.push("--");
                        if (response[i].finaltarget != userid){
                            all_notdrinking.push("非本人");
                        } else{
                            all_notdrinking.push("--");
                        }
                        all_notdrinking.push(response[i].reason);
                        all_notdrinking.push(response[i].brac);
                        all_notdrinking.push(response[i].time);
                        all_notdrinking.push(response[i].date);
                        all_notdrinking.push("沒喝酒"); 
                        //   
                        all.push("--");
                        all.push("--");
                        if (response[i].finaltarget != userid){
                            all.push("非本人");
                        } else{
                            all.push("--");
                        }
                        all.push(response[i].reason);
                        all.push(response[i].brac);
                        all.push(response[i].time);
                        all.push(response[i].date);
                        all.push("沒喝酒");                 
                    }
                }
            }
        });
        $.ajax({
            type: 'post',
            url: 'get_vehical_data.php',
            data: "userid="+ userid,
            dataType: 'json',
            async: false,
            success: function(response) {
                len = response.length;
                for (var i = 0; i < len; i++){
                    if (response[i].tag == -1){
                        all_nonreporting.push(response[i].interval);
                        all_nonreporting.push(response[i].last);
                        all_nonreporting.push("--");
                        all_nonreporting.push("--");
                        all_nonreporting.push("--");
                        all_nonreporting.push(response[i].time);
                        all_nonreporting.push(response[i].date);
                        all_nonreporting.push("未回報");
                        //
                        all.push(response[i].interval);
                        all.push(response[i].last);
                        all.push("--");
                        all.push("--");
                        all.push("--");
                        all.push(response[i].time);
                        all.push(response[i].date);
                        all.push("未回報");
                    } else if (response[i].tag == 0){
                        all_nonselfdriving.push(response[i].interval);
                        all_nonselfdriving.push(response[i].last);
                        all_nonselfdriving.push("--");
                        all_nonselfdriving.push("--");
                        all_nonselfdriving.push("--");
                        all_nonselfdriving.push(response[i].time);
                        all_nonselfdriving.push(response[i].date);
                        all_nonselfdriving.push("非自駕");       
                        //    
                        all.push(response[i].interval);
                        all.push(response[i].last);
                        all.push("--");
                        all.push("--");
                        all.push("--");
                        all.push(response[i].time);
                        all.push(response[i].date);
                        all.push("非自駕");        
                    } else {
                        all_selfdriving.push(response[i].interval);
                        all_selfdriving.push(response[i].last);
                        all_selfdriving.push("--");
                        all_selfdriving.push("--");
                        all_selfdriving.push("--");
                        all_selfdriving.push(response[i].time);
                        all_selfdriving.push(response[i].date);
                        all_selfdriving.push("自駕");     
                        //
                        all.push(response[i].interval);
                        all.push(response[i].last);
                        all.push("--");
                        all.push("--");
                        all.push("--");
                        all.push(response[i].time);
                        all.push(response[i].date);
                        all.push("自駕");  
                    }
                }
            }
        });
        showall();

        function showall(){
            if(ALL){
                var tableRef = document.getElementById('table').getElementsByTagName('tbody')[0];
                while(tableRef.rows.length > 1) {
                    tableRef.deleteRow(tableRef.rows.length-1); 
                }
                for (var i = 0; i < all.length/8; i++){
                    var newRow   = tableRef.insertRow(tableRef.rows.length);
                    for (var j = 0; j < 8; j++){
                        var newCell  = newRow.insertCell(0);
                        var newText  = document.createTextNode(all[i*8+j]);
                        newCell.appendChild(newText);
                    }
                } 
                ALL = !ALL;
            } else{
                var tableRef = document.getElementById('table').getElementsByTagName('tbody')[0];
                while(tableRef.rows.length > 1) {
                    tableRef.deleteRow(tableRef.rows.length-1); 
                }
                querydata();
                ALL = !ALL;
            }
        }
        function notdrink() {
            console.log(ALL);
            var tableRef = document.getElementById('table').getElementsByTagName('tbody')[0];
            while(tableRef.rows.length > 1) {
                tableRef.deleteRow(tableRef.rows.length-1); 
            }
            var len;
            if (!ALL){
                len = all_notdrinking.length/8;
            } else{
                len = notdrinking.length/8;
            }
            for (var i = 0; i < len; i++){
                var newRow   = tableRef.insertRow(tableRef.rows.length);
                for (var j = 0; j < 8; j++){
                    var newCell  = newRow.insertCell(0);
                    var newText;
                    if (!ALL){
                        newText  = document.createTextNode(all_notdrinking[i*8+j]);
                    } else{
                        newText  = document.createTextNode(notdrinking[i*8+j]);
                    }
                    newCell.appendChild(newText);
                }
            }  
        }
        function drink() {
            var tableRef = document.getElementById('table').getElementsByTagName('tbody')[0];
            while(tableRef.rows.length > 1) {
                tableRef.deleteRow(tableRef.rows.length-1); 
            }
            var len;
            if (!ALL){
                len = all_drinking.length/8;
            } else{
                len = drinking.length/8;
            }
            for (var i = 0; i < len; i++){
                var newRow   = tableRef.insertRow(tableRef.rows.length);
                for (var j = 0; j < 8; j++){
                    var newCell  = newRow.insertCell(0);
                    var newText;
                    if (!ALL){
                        newText  = document.createTextNode(all_drinking[i*8+j]);
                    } else{
                        newText  = document.createTextNode(drinking[i*8+j]);
                    }
                    newCell.appendChild(newText);
                }
            }   
        }
        function notselfdrive() {
            var tableRef = document.getElementById('table').getElementsByTagName('tbody')[0];
            while(tableRef.rows.length > 1) {
                tableRef.deleteRow(tableRef.rows.length-1); 
            }
            var len;
            if (!ALL){
                len = all_nonselfdriving.length/8;
            } else{
                len = nonselfdriving.length/8;
            }
            for (var i = 0; i < len; i++){
                var newRow   = tableRef.insertRow(tableRef.rows.length);
                for (var j = 0; j < 8; j++){
                    var newCell  = newRow.insertCell(0);
                    var newText;
                    if (!ALL){
                        newText  = document.createTextNode(all_nonselfdriving[i*8+j]);
                    } else{
                        newText  = document.createTextNode(nonselfdriving[i*8+j]);
                    }
                    newCell.appendChild(newText);
                }
            }   
        }
        function selfdrive() {
            var tableRef = document.getElementById('table').getElementsByTagName('tbody')[0];
            while(tableRef.rows.length > 1) {
                tableRef.deleteRow(tableRef.rows.length-1); 
            }
            var len;
            if (!ALL){
                len = all_selfdriving.length/8;
            } else{
                len = selfdriving.length/8;
            }
            for (var i = 0; i < len; i++){
                var newRow   = tableRef.insertRow(tableRef.rows.length);
                for (var j = 0; j < 8; j++){
                    var newCell  = newRow.insertCell(0);
                    var newText;
                    if (!ALL){
                        newText  = document.createTextNode(all_selfdriving[i*8+j]);
                    } else{
                        newText  = document.createTextNode(selfdriving[i*8+j]);
                    }
                    newCell.appendChild(newText);
                }
            } 
        }
        function notreport() {
            var tableRef = document.getElementById('table').getElementsByTagName('tbody')[0];
            while(tableRef.rows.length > 1) {
                tableRef.deleteRow(tableRef.rows.length-1); 
            }
            var len;
            if (!ALL){
                len = all_nonreporting.length/8;
            } else{
                len = nonreporting.length/8;
            }
            for (var i = 0; i < len; i++){
                var newRow   = tableRef.insertRow(tableRef.rows.length);
                for (var j = 0; j < 8; j++){
                    var newCell  = newRow.insertCell(0);
                    var newText;
                    if (!ALL){
                        newText  = document.createTextNode(all_nonreporting[i*8+j]);
                    } else{
                        newText  = document.createTextNode(nonreporting[i*8+j]);
                    }
                    newCell.appendChild(newText);
                }
            } 
        }
        function querydata(){
            var tableRef = document.getElementById('table').getElementsByTagName('tbody')[0];
            while(tableRef.rows.length > 1) {
                tableRef.deleteRow(tableRef.rows.length-1); 
            }
            drinking = [];
            notdrinking = [];
            selfdriving = [];
            nonselfdriving = [];
            nonreporting = [];
            var e = document.getElementById("month");
            month = e.options[e.selectedIndex].value;
            e = document.getElementById("week");
            week = e.options[e.selectedIndex].value;
            $.ajax({
                type: 'post',
                url: 'get_alcohol_data_time.php',
                data: {userid: userid, month: month, week: week},
                dataType: 'json',
                async: false,
                success: function(response) {
                    len = response.length;
                    for (var i = 0; i < len; i++){
                        if (response[i].brac > 0.06){
                            drinking.push("--");
                            drinking.push("--");
                            if (response[i].finaltarget != userid){
                                drinking.push("非本人");
                            } else{
                                drinking.push("--");
                            }
                            drinking.push(response[i].reason);
                            drinking.push(response[i].brac);
                            drinking.push(response[i].time);
                            drinking.push(response[i].date);
                            drinking.push("有喝酒");     
                        } else {
                            notdrinking.push("--");
                            notdrinking.push("--");
                            if (response[i].finaltarget != userid){
                                notdrinking.push("非本人");
                            } else{
                                notdrinking.push("--");
                            }
                            notdrinking.push(response[i].reason);
                            notdrinking.push(response[i].brac);
                            notdrinking.push(response[i].time);
                            notdrinking.push(response[i].date);
                            notdrinking.push("沒喝酒");                    
                        }
                    }
                }
            });
            $.ajax({
                type: 'post',
                url: 'get_vehical_data_time.php',
                data: {userid: userid, month: month, week: week},
                dataType: 'json',
                async: false,
                success: function(response) {
                    len = response.length;
                    for (var i = 0; i < len; i++){
                        if (response[i].tag == -1){
                            nonreporting.push(response[i].interval);
                            nonreporting.push(response[i].last);
                            nonreporting.push("--");
                            nonreporting.push("--");
                            nonreporting.push("--");
                            nonreporting.push(response[i].time);
                            nonreporting.push(response[i].date);
                            nonreporting.push("未回報");
                            
                        } else if (response[i].tag == 0){
                            nonselfdriving.push(response[i].interval);
                            nonselfdriving.push(response[i].last);
                            nonselfdriving.push("--");
                            nonselfdriving.push("--");
                            nonselfdriving.push("--");
                            nonselfdriving.push(response[i].time);
                            nonselfdriving.push(response[i].date);
                            nonselfdriving.push("非自駕");                  
                        } else {
                            selfdriving.push(response[i].interval);
                            selfdriving.push(response[i].last);
                            selfdriving.push("--");
                            selfdriving.push("--");
                            selfdriving.push("--");
                            selfdriving.push(response[i].time);
                            selfdriving.push(response[i].date);
                            selfdriving.push("自駕");     
                        }
                    }
                }
            });
        }
        

    </script>
    -->

    <div id="footer" style="text-align:center;">
        <p style="font-size:20px">總覽</p>
        <div class="tabs">
            <ul class="tab-links">
                <li class="active"><a href="#tab1">酒測資料</a></li>
                <li><a href="#tab2">問題列表</a></li>
                <li><a href="#tab3">未確認移動狀況</a></li>
                <li><a href="#tab4">已確認移動狀況</a></li>
                <li><a href="#tab34">移動狀況圖表</a></li>
                <li><a href="#tab5">ClickLog</a></li>
                <li><a href="#tab6">ClickLog2</a></li>
                <li><a href="#tab7">ClickLog3</a></li>
            </ul>
 
            <div class="tab-content">
                <div id="tab1" class="tab active">
                    <table id="alcohol" class="display" width="100%"></table>
                    <!--
                    <table id="table1">
                        <tbody>
                        <tr>
                            <th width="10%">日期</th>
                            <th width="10%">時間</th>
                            <th width="10%">酒測值</th>
                            <th width="10%">喝酒原因</th>
                            <th width="10%">時段</th>
                            <th width="10%">自填問卷</th>
                        </tr>
                        </tbody>
                    </table>
                    -->
                </div>
                <div id="tab2" class="tab">
                    <table id="problem" class="display" width="100%"></table>
                    <!--
                    <table id="table2">
                        <tbody>
                        <tr>
                            <th width="10%">日期</th>
                            <th width="10%">藍芽連線</th>
                            <th width="10%">臉抓不到</th>
                            <th width="10%">條碼掃不到</th>
                            <th width="10%">酒測器一<br>直在恢復</th>
                            <th width="10%">吹氣不穩定</th>
                            <th width="10%">臉部辨識<br>非本人次數</th>
                            <th width="10%">對應的圖</th>
                        </tr>
                        </tbody>
                    </table>
                    -->
                </div>
                <div id="tab3" class="tab">
                    <table id="vehicaltag" class="display" width="100%"></table>
                    <!--
                    <table id="table3">
                        <tbody>
                        <tr>
                            <th width="10%">日期</th>
                            <th width="10%">移動開始</th>
                            <th width="10%">移動結束</th>
                            <th width="10%">距離移動開始<br>最近的酒測時間<br>(時:分)</th>
                            <th width="10%">最近的酒測時間</th>
                            <th width="10%">當次酒測<br>自填問卷</th>
                            <th width="10%">移動回報時間</th>
                            <th width="10%">移動回報狀況</th>
                            <th width="10%">AlcoholScreeningID</th>
                        </tr>
                        </tbody>
                    </table>
                    -->
                </div>
                <div id="tab4" class="tab">
                    <table id="vehical" class="display" width="100%"></table>
                    <!--
                    <table id="table4">
                        <tbody>
                        <tr>
                            <th width="10%">日期</th>
                            <th width="10%">移動開始</th>
                            <th width="10%">移動結束</th>
                            <th width="10%">距離移動開始<br>最近的酒測時間<br>(時:分)</th>
                            <th width="10%">最近的酒測時間</th>
                        </tr>
                        </tbody>
                    </table>
                    -->
                </div>
                <div id="tab34" class="tab">
                    <canvas id="vehical_graph"></canvas>
                    <!--
                    <table id="table4">
                        <tbody>
                        <tr>
                            <th width="10%">日期</th>
                            <th width="10%">移動開始</th>
                            <th width="10%">移動結束</th>
                            <th width="10%">距離移動開始<br>最近的酒測時間<br>(時:分)</th>
                            <th width="10%">最近的酒測時間</th>
                        </tr>
                        </tbody>
                    </table>
                    -->
                </div>
                <div id="tab5" class="tab">
                    <table id="clicklog" class="display" width="100%"></table>
                    <!--
                    <table id="table5">
                        <tbody>
                        <tr>
                            <th width="10%">時間</th>
                            <th width="10%">Action</th>
                        </tr>
                        </tbody>
                    </table>
                    -->
                </div>
                <div id="tab6" class="tab">
                    <table id="clicklog2" class="display" width="100%"></table>
                </div>
                <div id="tab7" class="tab">
                    <table id="clicklog3" class="display" width="100%"></table>
                </div>
            </div>
        </div>
    </div>
    <script src="//code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://cdn.datatables.net/1.10.15/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript">
        var alcohol = [];
        var problem = [];
        var photo = [];
        var vehicaltag = [];
        var vehical = [];
        var clk = [];
        var clk2 = [];
        var clk3 = [];
        var vehicaltag_graph = [];
        var vehical_graph = [];
        var lineChartData = {}; //declare an object
		lineChartData.datasets = []; //add 'datasets' array element to object

        $.ajax({
                type: 'post',
                url: 'get_alcohol_data.php',
                data: {userid: userid},
                dataType: 'json',
                async: false,
                success: function(response) {
                    len = response.length;
                    for (var i = len-1; i > -1; i--){
                        alcohol.push($.map(response[i], function(el) { return el }));
                    }
                    /*
                    len = response.length;
                    for (var i = len-1; i > -1; i--){
                        alcohol.push(response[i].selfpredict);
                        alcohol.push(response[i].timeslot);
                        switch(response[i].reasonchoice){
                            case "0":
                                alcohol.push("工作提神");
                                break;
                            case "1":
                                alcohol.push("交際應酬");
                                break;
                            case "2":
                                alcohol.push("幫助睡眠");
                                break;
                            case "3":
                                alcohol.push("無聊");
                                break;
                            case "4":
                                alcohol.push("別人勸酒");
                                break;
                            case "5":
                                alcohol.push("親友聚餐");
                                break;
                            case "6":
                                alcohol.push("親友吵架");
                                break;
                            case "7":
                                alcohol.push("鬱卒");
                                break;
                            case "8":
                                alcohol.push(response[i].reason);
                                break;
                            case "9":
                                alcohol.push("沒填理由");
                                break;
                            defaults:
                                alcohol.push("--");
                                break;
                        }
                        alcohol.push(response[i].brac);
                        alcohol.push(response[i].time);
                        alcohol.push(response[i].date);
                    }
                    */
                }
        });
        $.ajax({
                type: 'post',
                url: 'get_breath_data.php',
                data: {userid: userid},
                dataType: 'json',
                async: false,
                success: function(response) {
                    var data1 = response['result1'];
                    var data2 = response['result2'];
                    len = data1.length;
                    for (var i = 0; i < len; i++){
                        problem.push($.map(data1[i], function(el) { return el }));
                        //problem[i].push(i);
                        //problem.push(i);
                        //console.log(problem[i][0]);
                        var k = 0;
                        var img = '';
                        if (data2.length != 0){
                            while(problem[i][0] == data2[k].date){
                                var src = 'https://140.112.170.34/SoberMotion/upload/offender/';
                                src = src + userid + '/';
                                src = src + data2[k].assessment + '/';
                                src = src + data2[k].name + '.jpg';
                                
                                var html_tag = '<img src='+'"'+src+'" '+'title='+'"'+data2[k].time+'" '+'height=50 '+'width=50 '+'onMouseOver="this.style.width=200;this.style.height=200" '+'onMouseOut="this.style.width=50;this.style.height=50">';

                                img = img + ' ' + html_tag;
                                k++;
                                if(k == data2.length) break;
                            }
                        }
                        problem[i].push(img);
                    }
                    /*
                    for (var i = len-1; i > -1; i--){
                        problem.push('');
                        problem.push(data1[i].unknown);
                        problem.push(data1[i].abnormal);
                        problem.push(data1[i].init);
                        problem.push(data1[i].nomarker);
                        problem.push(data1[i].noface);
                        problem.push(data1[i].bluetooth);
                        problem.push(data1[i].date);
                    }
                    photo = data2;*/
                    len = data2.length;
                    for (var i = len-1; i > -1; i--){
                        photo.push($.map(data2[i], function(el) { return el }));
                    }
                }
        });
        $.ajax({
                type: 'post',
                url: 'get_vehical_data.php',
                data: {userid: userid},
                dataType: 'json',
                async: false,
                success: function(response) {
                    var data_o = response['result1'];
                    var data_x = response['result2'];
                    var len = data_o.length;
                    for (var i = len-1; i > -1; i--){
                        vehical.push($.map(data_o[i], function(el) { return el }));
                    }
                    len = data_x.length;
                    for (var i = len-1; i > -1; i--){
                        vehicaltag.push($.map(data_x[i], function(el) { return el }));
                    }    
                }
        });
		$.ajax({
                type: 'post',
                url: 'get_vehical_graph_data.php',
                data: {userid: userid},
                dataType: 'json',
                async: false,
                success: function(response) {
                    vehical_graph = response['result1'];
                    vehicaltag_graph = response['result2'];
                    for (var i = 0; i < vehical_graph.length; i++) {
                    	//orange -> #FF8800
                    	//green -> #00FF00
                    	//red -> #FF0000
                    	var res = vehical_graph[i].lasttime.split(" ");
                    	var date_arr = res[0].split("-");
                    	var time_arr = res[1].split(":");
                    	var date = date_arr[1] + "-" + date_arr[2];
                    	var time = time_arr[0] + ":" + time_arr[1];
                    	if (vehical_graph[i].brac >= 0.15){
                    		lineChartData.datasets.push({"backgroundColor": "#FF0000",
    												"borderColor" : "#FF0000",
    												"fill" : false,
    												//"borderWidth" : 10,
    												//"pointRadius" : 0,
    												"data" :[
    													{x:time,
    													 y:date}
    												]
    												});
                    	} else if (vehical_graph[i].brac == 0.14){
                    		lineChartData.datasets.push({"backgroundColor": "#FF8800",
    												"borderColor" : "#FF8800",
    												"fill" : false,
    												//"borderWidth" : 10,
    												//"pointRadius" : 0,
    												"data" :[
    													{x:time,
    													 y:date}
    												]
    												});
                    	} else{
                    		lineChartData.datasets.push({"backgroundColor": "#00FF00",
    												"borderColor" : "#00FF00",
    												"fill" : false,
    												//"borderWidth" : 10,
    												//"pointRadius" : 0,
    												"data" :[
    													{x:time,
    													 y:date}
    												]
    												});
                    	}
                    }
                    for (var i = 0; i < vehicaltag_graph.length; i++) {
                    	//orange -> #FF8800
                    	//green -> #00FF00
                    	//red -> #FF0000
                    	var res = vehicaltag_graph[i].lasttime.split(" ");
                    	var date_arr = res[0].split("-");
                    	var time_arr = res[1].split(":");
                    	var date = date_arr[1] + "-" + date_arr[2];
                    	var time = time_arr[0] + ":" + time_arr[1];
                    	if (vehicaltag_graph[i].brac >= 0.15){
                    		lineChartData.datasets.push({"backgroundColor": "#FF0000",
    												"borderColor" : "#FF0000",
    												"fill" : false,
    												//"borderWidth" : 10,
    												//"pointRadius" : 0,
    												"data" :[
    													{x:time,
    													 y:date}
    												]
    												});
                    	} else if (vehicaltag_graph[i].brac == 0.14){
                    		lineChartData.datasets.push({"backgroundColor": "#FF8800",
    												"borderColor" : "#FF8800",
    												"fill" : false,
    												//"borderWidth" : 10,
    												//"pointRadius" : 0,
    												"data" :[
    													{x:time,
    													 y:date}
    												]
    												});
                    	} else{
                    		lineChartData.datasets.push({"backgroundColor": "#00FF00",
    												"borderColor" : "#00FF00",
    												"fill" : false,
    												//"borderWidth" : 10,
    												//"pointRadius" : 0,
    												"data" :[
    													{x:time,
    													 y:date}
    												]
    												});
                    	}
                    }
                    for (var i = 0; i < vehical_graph.length; i++) {
    					lineChartData.datasets.push({"backgroundColor": "#4169E1",
    												"borderColor" : "#4169E1",
    												"fill" : false,
    												//"borderWidth" : 10,
    												"pointRadius" : 2,
    												"data" :[
    													{x:vehical_graph[i].stime,
    													 y:vehical_graph[i].date},
    													{x:vehical_graph[i].etime,
    													 y:vehical_graph[i].date},
    												]
    												});
                    }
                    for (var i = 0; i < vehicaltag_graph.length; i++) {
                        lineChartData.datasets.push({"backgroundColor": "#AAAAAA",
                                                    "borderColor" : "#AAAAAA",
                                                    "fill" : false,
                                                    //"borderWidth" : 10,
                                                    "pointRadius" : 2,
                                                    "data" :[
                                                        {x:vehicaltag_graph[i].stime,
                                                         y:vehicaltag_graph[i].date},
                                                        {x:vehicaltag_graph[i].etime,
                                                         y:vehicaltag_graph[i].date},
                                                    ]
                                                    });
                    }
                }
        });
        $.ajax({
                type: 'post',
                url: 'clicklog.php',
                data: {userid: userid},
                dataType: 'json',
                async: false,
                success: function(response) {
                    len = response.length;
                    for (var i = len-1; i > -1; i--){
                        clk.push($.map(response[i], function(el) { return el }));
                    }
                    /*
                    len = response.length;
                    for (var i = len-1; i > -1; i--){
                        clk.push(response[i].clicklog);
                        clk.push(response[i].times);
                    }*/
                }
        });
        $.ajax({
                type: 'post',
                url: 'clicklog2.php',
                data: {userid: userid},
                dataType: 'json',
                async: false,
                success: function(response) {
                    len = response.length;
                    for (var i = len-1; i > -1; i--){
                        clk2.push($.map(response[i], function(el) { return el }));
                    }
                    /*
                    len = response.length;
                    for (var i = len-1; i > -1; i--){
                        clk.push(response[i].clicklog);
                        clk.push(response[i].times);
                    }*/
                }
        });
        $.ajax({
                type: 'post',
                url: 'clicklog3.php',
                data: {userid: userid},
                dataType: 'json',
                async: false,
                success: function(response) {
                    len = response.length;
                    for (var i = len-1; i > -1; i--){
                        clk3.push($.map(response[i], function(el) { return el }));
                    }
                }
        });


        showalcohol();

        jQuery(document).ready(function() {
            jQuery('.tabs .tab-links a').on('click', function(e)  {
                 currentAttrValue = jQuery(this).attr('href');
     
                // Show/Hide Tabs
                jQuery('.tabs ' + currentAttrValue).show().siblings().hide();
                // Change/remove current tab to active
                jQuery(this).parent('li').addClass('active').siblings().removeClass('active');
     
                e.preventDefault();
                if (currentAttrValue == '#tab1'){
                    showalcohol();
                } else if (currentAttrValue == '#tab2'){
                    showproblem();
                } else if (currentAttrValue == '#tab3'){
                    showvehicaltag();
                } else if (currentAttrValue == '#tab4'){
                    showvehical();
                } else if (currentAttrValue == '#tab5'){
                    showclk();
                } else if (currentAttrValue == '#tab6'){
                    showclk2();
                } else if (currentAttrValue == '#tab7'){
                    showclk3();
                }
            });
        });

        function showalcohol(){
            $(document).ready(function() {
            $('#alcohol').DataTable( {
                "order": [[ 0, "desc" ]],
                destroy: true,
                data: alcohol,
                columns: [
                    { title: "日期" },
                    { title: "時間" },
                    { title: "酒測值" },
                    { title: "喝酒原因" },
                    { title: "時段" },
                    { title: "自填問卷" }
                ],
                "fnRowCallback": function( nRow, aData, iDisplayIndex, iDisplayIndexFull ) {
                            if ( aData[2] >= 0.15 ){
                                $('td', nRow).css('background-color', '#FFB6C1');
                                //
                                //console.log(iDisplayIndex);
                            }
                        }
                } );
            } );
        }

        function showproblem(){
            $(document).ready(function() {
            $('#problem').DataTable( {
                "order": [[ 0, "desc" ]],
                destroy: true,
                data: problem,
                columns: [
                    { title: "日期" },
                    { title: "藍芽連線" },
                    { title: "臉抓不到" },
                    { title: "條碼掃不到" },
                    { title: "酒測器一直在恢復" },
                    { title: "吹氣不穩" },
                    { title: "臉部辨識<br>非本人次數" },
                    { title: "對應的圖" }
                ]
            } );
             } );
        }

        function showvehicaltag(){
            $(document).ready(function() {
            $('#vehicaltag').DataTable( {
                "order": [[ 0, "desc" ]],
                destroy: true,
                data: vehicaltag,
                columns: [
                    { title: "日期" },
                    { title: "移動開始" },
                    { title: "移動結束" },
                    { title: "距離移動開始<br>最近的酒測時間<br>(時:分)" },
                    { title: "最近的酒測時間" },
		            { title: "當次酒測值"},
                    { title: "當次酒測<br>自填問卷" },
                    { title: "移動回報<br>時間" },
                    { title: "移動回報<br>狀況" },
                    { title: "Alcohol<br>Screening<br>ID" }
                ]
            } );
             } );
        }


        function showvehical(){
            $(document).ready(function() {
            $('#vehical').DataTable( {
                "order": [[ 0, "desc" ]],
                destroy: true,
                data: vehical,
                columns: [
                    { title: "日期" },
                    { title: "移動開始" },
                    { title: "移動結束" },
                    { title: "距離移動開始<br>最近的酒測時間<br>(時:分)" },
                    { title: "最近的酒測時間" },
		            { title: "當次酒測值"}
                ]
            } );
             } );
        }

        function showclk(){
            $(document).ready(function() {
            $('#clicklog').DataTable( {
                "order": [[ 0, "desc" ]],
                destroy: true,
                data: clk,
                columns: [
                    { title: "時間" },
                    { title: "Action" }
                ]
            } );
             } );
        }
        function showclk2(){
            $(document).ready(function() {
            $('#clicklog2').DataTable( {
                "order": [[ 0, "desc" ]],
                destroy: true,
                data: clk2,
                columns: [
                    { title: "日期" },
                    { title: "tab1" },
                    { title: "tab2" },
                    { title: "tab3" },
                    { title: "tab4" }
                ]
            } );
             } );
        }
        function showclk3(){
            $(document).ready(function() {
            $('#clicklog3').DataTable( {
                "order": [[ 0, "desc" ]],
                destroy: true,
                data: clk3,
                columns: [
                    { title: "月份" },
                    { title: "tab1" },
                    { title: "tab2" },
                    { title: "tab3" },
                    { title: "tab4" }
                ]
            } );
             } );
        }

        function mouseOver(){  
            this.width = 200;
            this.height = 200;
        }
        function mouseOut(){  
            this.width = 50;
            this.height = 50;
        }        

        //vehical graph show
		var ctx = document.getElementById("vehical_graph");
		var myChart = new Chart(ctx, {
		type: 'line',
        data: lineChartData,
        options: {
            legend : {
                display : false
            },
            scales: {
                xAxes: [{
                    type: 'time',
                    time: {
					    format: "HH:mm",
					    unit: 'hour',
					    unitStepSize: 1,
					    displayFormats: {
					      'minute': 'HH:mm', 
					      'hour': 'HH:mm'
					    },
					},
                    position: 'bottom',
                    ticks: {
                		fontSize: 25
            		}
                }],
                yAxes : [{
                	type: 'time',
                    time: {
					    format: "MM-DD",
					    unit: 'day',
					    unitStepSize: 1,
					    displayFormats: {
					      'day': 'MM-DD', 
					      'month': 'MM-DD'
					    }
					},
                    position: 'left',
                    ticks: {
                		fontSize: 25,
            		}
                }]
            },
            tooltips: {
            	enabled: true,
            	callbacks: {
                    label: function(tooltipItem, data) {
                        //console.log(data['datasets'][tooltipItem.datasetIndex]['data'][0]);
                        if (tooltipItem.datasetIndex < vehical_graph.length){
                        	//console.log(alcohol_graph[tooltipItem.datasetIndex].brac);
                        	var brac = vehical_graph[tooltipItem.datasetIndex].brac;
                        	var res = vehical_graph[tooltipItem.datasetIndex].reason;
                        	return [brac, res];
                        } else if(tooltipItem.datasetIndex < vehical_graph.length + vehicaltag_graph.length){
                        	var brac = vehicaltag_graph[tooltipItem.datasetIndex - vehical_graph.length].brac;
                        	var res = vehicaltag_graph[tooltipItem.datasetIndex - vehical_graph.length].reason;
                        	return [brac, res];
                        } else if(tooltipItem.datasetIndex < vehical_graph.length + vehical_graph.length + vehicaltag_graph.length){
               				var start = data['datasets'][tooltipItem.datasetIndex]['data'][0]['x'];
               				var end = data['datasets'][tooltipItem.datasetIndex]['data'][1]['x'];
               				var label = start + "-" + end;
               				var last_arr = vehical_graph[tooltipItem.datasetIndex - vehical_graph.length - vehicaltag_graph.length].last.split(":");
                        	return ["已確認移動狀況", label, "距離上次酒測: "+last_arr[0]+"小時"+last_arr[1]+"分鐘"];
                        } else {
                        	var start = data['datasets'][tooltipItem.datasetIndex]['data'][0]['x'];
               				var end = data['datasets'][tooltipItem.datasetIndex]['data'][1]['x'];
               				var label = start + "-" + end;
               				var last_arr = vehicaltag_graph[tooltipItem.datasetIndex - vehical_graph.length - vehical_graph.length - vehicaltag_graph.length].last.split(":");
                        	return ["未確認移動狀況", label, "距離上次酒測: "+last_arr[0]+"小時"+last_arr[1]+"分鐘"];
                        }
                    }
                }
            }
            /*
            animation: {
                onComplete: function () {
                    var chartInstance = this.chart;
                    var ctx = chartInstance.ctx;
                    ctx.textAlign = "left";
                    ctx.font = "9px Open Sans";
                    ctx.fillStyle = "#000";

                    Chart.helpers.each(this.data.datasets.forEach(function (dataset, i) {
                        var meta = chartInstance.controller.getDatasetMeta(i);
                        Chart.helpers.each(meta.data.forEach(function (bar, index) {
                            data = dataset.data[index].x;
                            if(index%2==0){
                                ctx.fillText(data, bar._model.x, bar._model.y+4);
                            } else {
                                ctx.fillText(data, bar._model.x, bar._model.y+12);
                            }
                        }),this)
                    }),this);
                }
            }*/
        }
		});

        /*
        showalcohol();

        jQuery(document).ready(function() {
            jQuery('.tabs .tab-links a').on('click', function(e)  {
                 currentAttrValue = jQuery(this).attr('href');
     
                // Show/Hide Tabs
                jQuery('.tabs ' + currentAttrValue).show().siblings().hide();
                // Change/remove current tab to active
                jQuery(this).parent('li').addClass('active').siblings().removeClass('active');
     
                e.preventDefault();
                if (currentAttrValue == '#tab1'){
                    showalcohol();
                } else if (currentAttrValue == '#tab2'){
                    showproblem();
                } else if (currentAttrValue == '#tab3'){
                    showvehicaltag();
                } else if (currentAttrValue == '#tab4'){
                    showvehical();
                } else if (currentAttrValue == '#tab5'){
                    showclk();
                }
            });
        });

        function showalcohol(){
            var tableRef = document.getElementById('table1').getElementsByTagName('tbody')[0];
            while(tableRef.rows.length > 1) {
                tableRef.deleteRow(tableRef.rows.length-1); 
            }
            var len = alcohol.length/6;
            for (var i = 0; i < len; i++){
                var newRow = tableRef.insertRow(tableRef.rows.length);
                for (var j = 0; j < 6; j++){
                    var newCell = newRow.insertCell(0);
                    if (alcohol[i*6+3]>=0.15){
                        newCell.style.backgroundColor = "#FFB6C1"; 
                    }
                    var newText = document.createTextNode(alcohol[i*6+j]);
                    newCell.appendChild(newText);
                }
            } 
        }
        function showproblem(){
            var tableRef = document.getElementById('table2').getElementsByTagName('tbody')[0];
            while(tableRef.rows.length > 1) {
                tableRef.deleteRow(tableRef.rows.length-1); 
            }
            var len = problem.length/8;
            var k = 0;
            for (var i = 0; i < len; i++){
                var newRow = tableRef.insertRow(tableRef.rows.length);
                for (var j = 0; j < 8; j++){
                    if(j == 0 && photo.length !=0){
                        var newCell = newRow.insertCell(0);
                        while(problem[i*8+7] == photo[k].date){
                            var img = document.createElement("img");
                            img.src = 'https://140.112.170.34/SoberMotion/upload/offender/';
                            img.src = img.src + userid + '/';
                            img.src = img.src + photo[k].assessment + '/';
                            img.src = img.src + photo[k].name + '.jpg';
                            img.width = 50;
                            img.height = 50;
                            img.title = photo[k].time;

                            img.addEventListener("mouseover", mouseOver, false);
                            img.addEventListener("mouseout", mouseOut, false);
                            
                            newCell.appendChild(img);
                            //var newText = document.createTextNode(photo[k].date);
                            //newCell.appendChild(newText);
                            //console.log(img.src);
                            k++;
                            if(k == photo.length) break;
                        }
                        
                        //img.src = 'https://140.112.170.34/SoberMotion/upload/offender/DUI_001/1498292198385/5_1498292218372.jpg';
                        
                        //console.log(problem[i*8+7])
                        //var newCell = newRow.insertCell(0);
                        //var newText = document.createTextNode(problem[i*8+7]);
                        //newCell.appendChild(newText);
                    }else{
                        var newCell = newRow.insertCell(0);
                        var newText = document.createTextNode(problem[i*8+j]);
                        newCell.appendChild(newText);
                    }
                }
            }
        }
        function showvehicaltag(){
            var tableRef = document.getElementById('table3').getElementsByTagName('tbody')[0];
            while(tableRef.rows.length > 1) {
                tableRef.deleteRow(tableRef.rows.length-1); 
            }
            var len = vehicaltag.length/9;
            for (var i = 0; i < len; i++){
                var newRow = tableRef.insertRow(tableRef.rows.length);
                for (var j = 0; j < 9; j++){
                    var newCell = newRow.insertCell(0);
                    var newText = document.createTextNode(vehicaltag[i*9+j]);
                    newCell.appendChild(newText);
                }
            }
        }
        function showvehical(){
            var tableRef = document.getElementById('table4').getElementsByTagName('tbody')[0];
            while(tableRef.rows.length > 1) {
                tableRef.deleteRow(tableRef.rows.length-1); 
            }
            var len = vehical.length/5;
            for (var i = 0; i < len; i++){
                var newRow = tableRef.insertRow(tableRef.rows.length);
                for (var j = 0; j < 5; j++){
                    var newCell = newRow.insertCell(0);
                    var newText = document.createTextNode(vehical[i*5+j]);
                    newCell.appendChild(newText);
                }
            }
        }
        function showclk(){
            var tableRef = document.getElementById('table5').getElementsByTagName('tbody')[0];
            while(tableRef.rows.length > 1) {
                tableRef.deleteRow(tableRef.rows.length-1); 
            }
            var len = clk.length/2;
            for (var i = 0; i < len; i++){
                var newRow = tableRef.insertRow(tableRef.rows.length);
                for (var j = 0; j < 2; j++){
                    var newCell = newRow.insertCell(0);
                    var newText = document.createTextNode(clk[i*2+j]);
                    newCell.appendChild(newText);
                }
            }
        }
        function mouseOver(){  
            this.width = 200;
            this.height = 200;
        }
        function mouseOut(){  
            this.width = 50;
            this.height = 50;
        }
        */
    </script>

</div>
</body>
</html>
